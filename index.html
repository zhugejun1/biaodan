<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <title>Survey Data Generator</title>  
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  
    <style>  
        .container { max-width: 800px; margin: 2rem auto; padding: 20px; }  
        .chart-container { margin-top: 2rem; }  
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }  
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }  
        th { background-color: #f2f2f2; }  
    </style>  
</head>  
<body>  
    <div class="container">  
        <h1>数学课堂调查数据生成器</h1>  
        <button onclick="generateData()">生成20条样本数据</button>  
        <div class="chart-container">  
            <canvas id="prepMaterialsChart"></canvas>  
        </div>  
        <table id="dataTable">  
            <thead>  
                <tr>  
                    <th>课程ID</th>  
                    <th>日期</th>  
                    <th>预习材料评价</th>  
                    <th>顶点式掌握度</th>  
                    <th>对称轴掌握度</th>  
                </tr>  
            </thead>  
            <tbody></tbody>  
        </table>  
    </div>  

<script>  
function generateData() {  
    // 配置参数  
    const prepMaterialDistribution = [  
        { value: "Very helpful", weight: 0.4 },  
        { value: "Helpful", weight: 0.35 },  
        { value: "Neutral", weight: 0.15 },  
        { value: "Slightly helpful", weight: 0.07 },  
        { value: "Didn't preview", weight: 0.03 }  
    ];  

    // 生成数据  
    const mockData = Array.from({ length: 20 }, (_, i) => ({  
        courseId: `Math-${String.fromCharCode(65 + i)}`,  
        date: new Date(2024, 4, 15 + i % 5).toLocaleDateString(),  
        prepRating: weightedRandom(prepMaterialDistribution),  
        vertexMastery: Math.min(5, Math.round(normalDistribution(4.2, 0.8))),  
        axisMastery: Math.min(5, Math.round(normalDistribution(3.8, 1.1)))  
    }));  

    // 更新表格  
    renderTable(mockData);  
    updateChart(mockData);  
}  

// 核心算法函数保持不变  
function weightedRandom(options) {  
    const sum = options.reduce((acc, cur) => acc + cur.weight, 0);  
    const rand = Math.random() * sum;  
    let cumulative = 0;  
    for (const { value, weight } of options) {  
        cumulative += weight;  
        if (rand < cumulative) return value;  
    }  
}  

function normalDistribution(mean, stdDev) {  
    let u = 0, v = 0;  
    while (u === 0) u = Math.random();  
    while (v === 0) v = Math.random();  
    return mean + stdDev * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);  
}  

// 可视化渲染  
function renderTable(data) {  
    const tbody = document.querySelector('#dataTable tbody');  
    tbody.innerHTML = data.map(item => `  
        <tr>  
            <td>${item.courseId}</td>  
            <td>${item.date}</td>  
            <td>${item.prepRating}</td>  
            <td>${item.vertexMastery}</td>  
            <td>${item.axisMastery}</td>  
        </tr>  
    `).join('');  
}  

let chartInstance = null;  
function updateChart(data) {  
    const ctx = document.getElementById('prepMaterialsChart');  
    const ratings = data.map(d => d.prepRating);  
    
    const counts = {  
        'Very helpful': 0,  
        'Helpful': 0,  
        'Neutral': 0,  
        'Slightly helpful': 0,  
        'Didn\'t preview': 0  
    };  
    
    ratings.forEach(r => counts[r]++);  

    if (chartInstance) chartInstance.destroy();  
    
    chartInstance = new Chart(ctx, {  
        type: 'pie',  
        data: {  
            labels: Object.keys(counts),  
            datasets: [{  
                data: Object.values(counts),  
                backgroundColor: ['#4285F4', '#34A853', '#FBBC05', '#EA4335', '#9B59B6']  
            }]  
        },  
        options: {  
            responsive: true,  
            plugins: {  
                title: {  
                    display: true,  
                    text: '预习材料帮助程度分布'  
                }  
            }  
        }  
    });  
}  
</script>  
</body>  
</html>  
